<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:app="http://schemas.android.com/apk/res-auto">

    <data>
        <import type="android.view.View"/>
        <import type="android.text.InputType" />
        <import type="com.ustadmobile.core.util.MessageIdOption"/>
        <import type="com.ustadmobile.core.controller.ContentEntryEdit2Presenter.StorageOptions"/>
        <import type="com.ustadmobile.port.android.view.DropDownListAutoCompleteTextView"/>
        <import type="com.ustadmobile.port.android.view.DropDownListAutoCompleteTextView.OnDropDownListItemSelectedListener"/>

        <variable
            name="contentEntry"
            type="com.ustadmobile.lib.db.entities.ContentEntryWithLanguage" />

        <variable
            name="loading"
            type="boolean" />

        <variable
            name="fieldsEnabled"
            type="boolean" />

        <variable
            name="showFileImport"
            type="boolean" />

        <variable
            name="showLinkImport"
            type="boolean" />

        <variable
            name="isNewFolder"
            type="boolean" />

        <variable
            name="isFileNotSupported"
            type="boolean" />


        <variable
            name="supportedFiles"
            type="String" />

        <variable
            name="selectedFileUri"
            type="String" />


        <variable
            name="activityEventHandler"
            type="com.ustadmobile.port.android.view.ContentEntryEdit2FragmentEventHandler" />

        <variable
            name="licenceOptions"
            type="java.util.List&lt;MessageIdOption&gt;"/>

        <variable
            name="licenceSelectionListener"
            type="OnDropDownListItemSelectedListener&lt;MessageIdOption&gt;" />

    </data>


    <androidx.core.widget.NestedScrollView
        android:id="@+id/fragment_content_entry_edit2_edit_scroll"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        app:layout_behavior="@string/appbar_scrolling_view_behavior">

        <androidx.constraintlayout.widget.ConstraintLayout
            android:paddingTop="@dimen/dimen_16dp"
            android:paddingBottom="@dimen/dimen_20dp"
            android:id="@+id/fragment_content_entry_edit2_edit_clx"
            android:layout_width="match_parent"
            android:layout_height="wrap_content">


            <Button
                android:id="@+id/content_entry_select_file"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_margin="@dimen/dimen_16dp"
                android:backgroundTint="@color/accent"
                android:onClick="@{()-> activityEventHandler.onClickFileSelection()}"
                android:padding="@dimen/dimen_16dp"
                android:text="@{contentEntry.contentEntryUid == 0 ? @string/content_entry_label_select_file: @string/content_entry_label_update_file}"
                android:visibility="@{showFileImport ? View.VISIBLE: View.GONE}"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent"
                tools:text="@string/content_entry_label_select_file" />

            <Button
                android:visibility="@{showLinkImport ? View.VISIBLE: View.GONE}"
                android:backgroundTint="@color/accent"
                android:id="@+id/content_entry_update_link"
                android:layout_margin="@dimen/dimen_16dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/content_entry_select_file"
                android:layout_width="match_parent"
                android:padding="@dimen/dimen_16dp"
                tools:text="@string/content_entry_label_import_link"
                android:text="@{contentEntry.contentEntryUid == 0 ? @string/content_entry_label_import_link: @string/content_entry_label_update_link}"
                android:layout_height="wrap_content"/>

            <TextView
                android:visibility="@{isFileNotSupported ? View.VISIBLE: View.GONE}"
                android:layout_margin="@dimen/dimen_16dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/content_entry_update_link"
                android:layout_marginTop="@dimen/dimen_16dp"
                android:textSize="@dimen/text_body_small"
                android:id="@+id/selected_file_not_supported"
                android:text="@string/import_link_content_not_supported"
                android:layout_width="match_parent"
                tools:visibility="gone"
                android:textColor="@android:color/holo_red_dark"
                android:layout_height="wrap_content" />

            <TextView
                android:visibility="@{selectedFileUri.length() == 0 ? View.GONE: View.VISIBLE}"
                android:layout_margin="@dimen/dimen_16dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/selected_file_not_supported"
                android:layout_marginTop="@dimen/dimen_16dp"
                android:textSize="@dimen/text_body_small"
                android:id="@+id/selected_file_info"
                android:text="@string/content_creation_storage_option_title"
                android:layout_width="match_parent"
                android:layout_height="wrap_content" />

            <TextView
                android:visibility="@{isNewFolder ? View.GONE: View.VISIBLE}"
                android:layout_margin="@dimen/dimen_16dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/selected_file_info"
                android:layout_marginTop="@dimen/dimen_16dp"
                android:textSize="@dimen/text_body_small"
                android:id="@+id/supported_file_list"
                android:text="@{supportedFiles}"
                android:layout_width="match_parent"
                android:layout_height="wrap_content" />


            <com.google.android.material.textfield.TextInputLayout
                android:layout_marginTop="@dimen/dimen_16dp"
                android:id="@+id/entry_title"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                android:enabled="@{fieldsEnabled}"
                android:hint="@string/content_entry_label_title"
                app:hintEnabled="true"
                app:layout_constraintTop_toBottomOf="@+id/supported_file_list"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent">

                <!-- android:inputType="textCapWords" -->
                <com.google.android.material.textfield.TextInputEditText
                    android:id="@+id/entry_title_text"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:enabled="@{fieldsEnabled}"
                    android:text="@={contentEntry.title}" />
            </com.google.android.material.textfield.TextInputLayout>

            <com.google.android.material.textfield.TextInputLayout
                android:id="@+id/entry_description"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:hint="@string/entry_details_description"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                app:hintEnabled="true"
                android:enabled="@{fieldsEnabled}"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/entry_title">

                <com.google.android.material.textfield.TextInputEditText
                    android:text="@={contentEntry.description}"
                    android:id="@+id/entry_description_text"
                    android:enabled="@{fieldsEnabled}"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content" />
            </com.google.android.material.textfield.TextInputLayout>

            <com.google.android.material.textfield.TextInputLayout
                android:visibility="@{isNewFolder ? View.GONE: View.VISIBLE}"
                android:id="@+id/entry_author"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:hint="@string/entry_details_author"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                app:hintEnabled="true"
                android:enabled="@{fieldsEnabled}"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/entry_description">

                <com.google.android.material.textfield.TextInputEditText
                    android:text="@={contentEntry.author}"
                    android:id="@+id/entry_author_text"
                    android:enabled="@{fieldsEnabled}"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content" />
            </com.google.android.material.textfield.TextInputLayout>


            <com.google.android.material.textfield.TextInputLayout
                android:visibility="@{isNewFolder ? View.GONE: View.VISIBLE}"
                android:id="@+id/entry_publisher"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:hint="@string/entry_details_publisher"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                app:hintEnabled="true"
                android:enabled="@{fieldsEnabled}"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/entry_author">

                <com.google.android.material.textfield.TextInputEditText
                    android:text="@={contentEntry.publisher}"
                    android:id="@+id/entry_publisher_text"
                    android:enabled="@{fieldsEnabled}"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content" />
            </com.google.android.material.textfield.TextInputLayout>


            <com.google.android.material.textfield.TextInputLayout
                android:layout_marginTop="@dimen/dimen_16dp"
                android:id="@+id/entry_licence"
                app:layout_constraintStart_toStartOf="parent"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.ExposedDropdownMenu"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                app:layout_constraintTop_toBottomOf="@+id/entry_publisher">

                <com.ustadmobile.port.android.view.MessageIdAutoCompleteTextView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    app:selectedMessageIdOption="@={contentEntry.licenseType}"
                    app:messageIdOptions="@{licenceOptions}"
                    android:hint="@string/content_entry_label_licence"/>

            </com.google.android.material.textfield.TextInputLayout>


            <com.google.android.material.textfield.TextInputLayout
                android:layout_marginTop="@dimen/dimen_16dp"
                android:id="@+id/container_base_dir"
                app:layout_constraintStart_toStartOf="parent"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.ExposedDropdownMenu"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                app:layout_constraintTop_toBottomOf="@+id/entry_licence">

                <androidx.appcompat.widget.AppCompatSpinner
                    android:id="@+id/container_storage_option"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:hint="@string/content_creation_storage_option_title"/>

            </com.google.android.material.textfield.TextInputLayout>


            <RelativeLayout
                android:layout_margin="@dimen/dimen_16dp"
                android:clickable="true"
                android:focusable="true"
                android:id="@+id/entry_content_public"
                android:layout_width="match_parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/container_base_dir"
                android:layout_height="wrap_content">
                <TextView
                    android:layout_centerVertical="true"
                    android:layout_toStartOf="@+id/entry_public_switch"
                    android:id="@+id/entry_visibility_public_label"
                    android:textSize="@dimen/text_body"
                    android:text="@string/content_entry_label_public"
                    android:textColor="@color/text_primary"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent" />

                <androidx.appcompat.widget.SwitchCompat
                    android:onCheckedChanged="@{(compoundButton, checked) -> activityEventHandler.onEntryPublicStatusChanged(checked)}"
                    android:checked="@{contentEntry.publik}"
                    android:theme="@style/Custom.SwitchCompat"
                    android:layout_alignParentEnd="true"
                    android:id="@+id/entry_public_switch"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"/>
            </RelativeLayout>

            <com.google.android.material.textfield.TextInputLayout
                android:visibility="@{isNewFolder ? View.GONE: View.VISIBLE}"
                android:id="@+id/entry_language"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginHorizontal="@dimen/form_margin_horizontal"
                android:layout_marginVertical="@dimen/formitem_margin_vertical"
                android:hint="@string/language"
                style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"
                app:hintEnabled="true"
                android:enabled="@{fieldsEnabled}"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/entry_content_public">

                <com.google.android.material.textfield.TextInputEditText
                    app:runOnClickWhenFocused="@{true}"
                    android:text="@={contentEntry.language.name}"
                    android:id="@+id/entry_language_text"
                    android:enabled="@{fieldsEnabled}"
                    android:onClick="@{()->activityEventHandler.handleClickLanguage()}"
                    android:inputType="@{InputType.TYPE_NULL}"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content" />
            </com.google.android.material.textfield.TextInputLayout>

        </androidx.constraintlayout.widget.ConstraintLayout>

    </androidx.core.widget.NestedScrollView>


</layout>
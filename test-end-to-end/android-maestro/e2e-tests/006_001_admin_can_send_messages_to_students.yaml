appId: com.toughra.ustadmobile
env:
  TESTRESULTSDIR: "${TESTRESULTSDIR}/006_001_admin_can_send_messages_to_students"
  TESTNAME: "006_001_admin_can_send_messages_to_students"
---
- clearState: com.toughra.ustadmobile
- runFlow:
    file: "../common/startserver.yaml"
    env:
      CONTROLSERVER: ${CONTROLSERVER}
      TESTSERIAL: ${TESTSERIAL}
      TESTNAME: ${TESTNAME}
- runFlow: "../common/clear_state_and_get_started.yaml"
- runFlow: "../common/select_site.yaml"
- runFlow:
    file: "../common/user_login.yaml"
- runFlow:
    file: "../common/add_course.yaml"
    env:
      TESTCOURSENAME: "Test Course Block"
# add new teacher using flow - add_new_teacher_inside_course ---------
- runFlow:
    file: "../common/add_new_teacher_inside_course.yaml"
    env:
      TESTCOURSENAME: ${TESTCOURSENAME}
      TEACHERFIRSTNAME: "Teacher"
      TEACHERLASTNAME: "1"
      USERNAME: "t1"
      GENDER: "Female"
      PASSWORD: "testt1"
# add students to the course through bulk import using .csv file
- runFlow:
    file: "../common/student_bulk_upload_csv.yaml"
    env:
      TESTFILENAME: "Ustad_Students_List.csv"
      CONTROLSERVER: ${CONTROLSERVER}
      TESTSERIAL: ${TESTSERIAL}
- runFlow:
    file: "../common/add_new_people.yaml"
    env:
      FIRSTNAME: "Student"
      LASTNAME: "A"
      USERNAME: "sa"
      GENDER: "Male"
      PASSWORD: "testsa"

- runFlow: "../common/clear_state_and_get_started.yaml"
- runFlow: "../common/select_site.yaml"
- runFlow:
    file: "../common/user_login.yaml"
    env:
      USERNAME: "t1"
      PASSWORD: "testt1"
- tapOn: "Messages"
- tapOn:
    id: "floating_action_button"
- tapOn: "Student 1"
- tapOn: "Message"
- inputText: "Hi , I am teacher, Please add your profile pic"
- back
# test teacher can't send messages to student not enrolled in same course
- tapOn:
    id: "floating_action_button"
- assertNotVisible: "Student A"

# this test user only has permission to message person within same course
- runFlow: "../common/clear_state_and_get_started.yaml"
- runFlow: "../common/select_site.yaml"
- runFlow:
    file: "../common/user_login.yaml"
    env:
      USERNAME: "s1"
      PASSWORD: "tests1"
- tapOn: "Messages"
- tapOn: "Teacher 1"
- assertVisible: "Hi , I am teacher, Please add your profile pic"
- tapOn: "Message"
- inputText: "Hi ,Sure Sir"
- tapOn: "Send"
